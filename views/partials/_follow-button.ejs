<div class="follow-action-partial">
  <% if (user) { %>
    <div class="follow-container"
         data-movie-id="<%= movie.id %>"
         data-title="<%= movie.title %>"
         data-release-date="<%= movie.displayDate %>"
         data-poster-path="<%= movie.poster_path %>">

      <div class="follow-options-panel" aria-hidden="true">
        <button class="follow-type-btn" data-type="theatrical" title="Follow Theatrical Release">ðŸŽ­</button>
        <button class="follow-type-btn" data-type="streaming" title="Follow Streaming Release">ðŸ“º</button>
        <button class="follow-type-btn" data-type="both" title="Follow Both Releases">ðŸŽ¬</button>
      </div>

      <% if (followedMovieIds && followedMovieIds.includes(Number(movie.id))) { %>
        <!-- Unfollow Button -->
        <form action="/unfollow/<%= movie.id %>" method="POST">
          <button type="submit" class="unfollow-button">Unfollow</button>
        </form>
      <% } else { %>
        <!-- Follow Button -->
        <form action="/follow/<%= movie.id %>" method="POST">
          <button type="submit" 
            class="follow-button" 
            <%= movie.canFollow ? '' : 'disabled title="Cannot follow â€” no streaming date and theatrical release over 21 days ago"' %>>
            Follow
          </button>
        </form>
      <% } %>
    </div>
  <% } else { %>
    <!-- Login to follow -->
    <a
      class="follow-btn login"
      href="/auth/login?redirect=<%= encodeURIComponent('/search?query=' + (query || '')) %>"
    >
      <i class="fas fa-user-lock"></i> Login to follow
    </a>
  <% } %>
</div>
