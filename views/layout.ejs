<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/images/android-chrome-512x512.png">
    
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/modules.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="<%= page %>-page">
    <nav class="navbar">
      <div class="nav-left">
        <a href="/"><img src="/images/logo.png" alt="Logo" class="logo" /></a>
      </div>

      <div class="nav-center">
        <div class="nav-links">
          <a href="/" class="<%= page === 'home' ? 'active' : '' %>">Home</a>
          <a href="/upcoming" class="<%= page === 'upcoming' ? 'active' : '' %>"
            >Upcoming</a
          >
          <a
            href="/top-releases"
            class="<%= page === 'top-releases' ? 'active' : '' %>"
            >Top Releases</a
          >
        </div>
      </div>

      <div class="nav-right">
        <% if (page !== 'home') { %>
        <form class="nav-search" action="/search" method="GET" role="search">
          <label for="nav-search-input" class="sr-only">Search for movies</label>
          <input 
            id="nav-search-input"
            type="text" 
            name="query" 
            placeholder="Search movies..." 
            required 
            autocomplete="off"
            aria-label="Search for movies"
          />
          <button 
            type="submit" 
            class="search-button"
            aria-label="Search"
            title="Search for movies"
          >
            <span class="search-icon" aria-hidden="true">üîç</span>
          </button>
        </form>
        <% } %>

        <div class="nav-user">
          <% if (isLoggedIn) { %>
          <div class="user-dropdown nav-user-dropdown">
            <button 
              class="user-toggle" 
              aria-expanded="false" 
              aria-haspopup="true"
              aria-label="User menu for <%= user ? (user.name || user.email) : 'user' %>"
              id="user-menu-button"
            >
              <% if (user) { %> 
                <span class="username"><%= user.name || user.email %></span>
                <span class="arrow" aria-hidden="true"></span>
              <% } %>
            </button>
            <div class="user-menu" role="menu" aria-labelledby="user-menu-button" aria-hidden="true">
              <a href="/my-movies" role="menuitem">My Movies</a>
              <a href="/profile" role="menuitem">Profile</a>
              <a href="/settings" role="menuitem">Settings</a>
              <a href="/auth/logout" role="menuitem">Logout</a>
            </div>
          </div>
          <% } else { %>
          <a href="/auth/login">Login</a>
          <% } %>
        </div>

        <button class="hamburger" id="hamburgerBtn">‚ò∞</button>
        
        <!-- Mobile Navigation Menu -->
        <div class="mobile-nav-links nav-links">
          <!-- User Section (at top) -->
          <% if (isLoggedIn) { %>
          <div class="mobile-nav-section mobile-user-section">
            <div class="mobile-section-label">Account</div>
            <a href="/my-movies">My Movies</a>
            <a href="/profile">Profile</a>
            <a href="/settings">Settings</a>
            <a href="/auth/logout" class="logout-link">Logout</a>
          </div>
          <% } %>

          <!-- Navigation Section -->
          <div class="mobile-nav-section">
            <div class="mobile-section-label">Navigate</div>
            <a href="/" class="<%= page === 'home' ? 'active' : '' %>">Home</a>
            <a href="/upcoming" class="<%= page === 'upcoming' ? 'active' : '' %>">Upcoming</a>
            <a href="/top-releases" class="<%= page === 'top-releases' ? 'active' : '' %>">Top Releases</a>
          </div>

          <% if (!isLoggedIn) { %>
          <div class="mobile-nav-section">
            <div class="mobile-section-label">Account</div>
            <a href="/auth/login">Login</a>
          </div>
          <% } %>
        </div>
      </div>
    </nav>

    <main><%- body %></main>

    <!-- Load JavaScript files -->
    <script src="/js/follow.js"></script>
    <script src="/js/navigation.js"></script>
  </body>
</html>
